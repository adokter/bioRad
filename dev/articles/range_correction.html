<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Correction for range effects • bioRad</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Correction for range effects">
<meta property="og:description" content="bioRad">
<meta property="og:image" content="https://adokter.github.io/bioRad/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bioRad</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.5.2.9419</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bioRad.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rad_aero_19.html">Introductory exercises with bioRad</a>
    </li>
    <li>
      <a href="../articles/range_correction.html">Correction for range effects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adokter/bioRad/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="range_correction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Correction for range effects</h1>
                        <h4 class="author">Adriaan M. Dokter</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/adokter/bioRad/blob/master/vignettes/range_correction.Rmd"><code>vignettes/range_correction.Rmd</code></a></small>
      <div class="hidden name"><code>range_correction.Rmd</code></div>

    </div>

    
    
<div id="preparations" class="section level2">
<h2 class="hasAnchor">
<a href="#preparations" class="anchor"></a>1 Preparations</h2>
<p>Load bioRad</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/adokter/bioRad">bioRad</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Welcome to bioRad version 0.5.2.9419</code></pre>
<pre><code>## Warning: Docker daemon not found</code></pre>
<pre><code>## Warning: bioRad functionality requiring Docker has been disabled
## 
## To enable Docker functionality, first install Docker</code></pre>
</div>
<div id="beam-propagation" class="section level2">
<h2 class="hasAnchor">
<a href="#beam-propagation" class="anchor"></a>2 Beam propagation</h2>
<p>We start with the changing properties of the radar beam as it propagates through the atmosphere. We define:</p>
<ul>
<li>
<strong>range</strong>: the length of the skywave path between target and the radar antenna, also known as <em>slant range</em>
</li>
<li>
<strong>distance</strong>: the distance of the target from the radar as measured along the earth’s surface, also known as <em>down range</em>.</li>
</ul>
<p>The beam height is changing as a result of earth’s curvature, and beam refraction:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define a range grid from 0 to 200 km:</span>
<span class="va">my_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200000</span>, <span class="fl">1000</span><span class="op">)</span>
<span class="co"># plot the beam height for each range, for a 0.5 degree elevation beam:</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">my_range</span>, <span class="fu"><a href="../reference/beam_height.html">beam_height</a></span><span class="op">(</span><span class="va">my_range</span>, elev <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"range [m]"</span>, ylab <span class="op">=</span> <span class="st">"beam height [m]"</span><span class="op">)</span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The beam width also broadens with range:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the beam width, for a beam opening angle of 1 degree (typical for most weather radars):</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">my_range</span>, <span class="fu"><a href="../reference/beam_width.html">beam_width</a></span><span class="op">(</span><span class="va">my_range</span>, beam_angle <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"range [m]"</span>, ylab <span class="op">=</span> <span class="st">"beam width [m]"</span><span class="op">)</span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>We can now combine the relations for beam width and beam height, to calculate the beam profile as a function of height, i.e. the altitudinal normalized distribution of radiated energy by the beam. Let’s plot the radiation profile for a 0.5 and 2 degree beam elevation at 50 km from the radar (the height axis runs from ground level straight up):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the beam profile, for a 0.5 degree elevation beam at 50 km distance from the radar:</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/beam_profile.html">beam_profile</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4000</span>, <span class="fl">50000</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">4000</span>, xlab <span class="op">=</span> <span class="st">"normalized radiated energy"</span>, ylab <span class="op">=</span> <span class="st">"height [m]"</span>, main <span class="op">=</span> <span class="st">"beam elevation: 0.5 deg, distance=50km"</span><span class="op">)</span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the beam profile, for a 2 degree elevation beam at 50 km distance from the radar:</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/beam_profile.html">beam_profile</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4000</span>, <span class="fl">50000</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">4000</span>, xlab <span class="op">=</span> <span class="st">"normalized radiated energy"</span>, ylab <span class="op">=</span> <span class="st">"height [m]"</span>, main <span class="op">=</span> <span class="st">"beam elevation: 2 deg, distance=50km"</span><span class="op">)</span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<p>We can also calculate the normalized radiation profile for the two beams combined:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the combined beam profile for a 0.5 and 2.0 degree elevation beam at 50 km distance from the radar:</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/beam_profile.html">beam_profile</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4000</span>, <span class="fl">50000</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">4000</span>, xlab <span class="op">=</span> <span class="st">"normalized radiated energy"</span>, ylab <span class="op">=</span> <span class="st">"height [m]"</span>, main <span class="op">=</span> <span class="st">"beam elevations: 0.5,2 deg, distance=50km"</span><span class="op">)</span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="vertical-profiles-and-polar-volumes" class="section level2">
<h2 class="hasAnchor">
<a href="#vertical-profiles-and-polar-volumes" class="anchor"></a>3 Vertical profiles and polar volumes</h2>
<p>Let us now assume we have calculated a vertical profile (of birds) for a certain polar volume file. Let’s load an example</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># let's load an example polar volume:</span>
<span class="va">pvolfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"volume.h5"</span>, package <span class="op">=</span> <span class="st">"bioRad"</span><span class="op">)</span>
<span class="va">example_pvol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_pvolfile.html">read_pvolfile</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">pvolfile</span><span class="op">)</span>
<span class="co"># a vertical profile can also be calculated from the polar volume directly, using</span>
<span class="co"># calculate_vp(pvolfile)</span>
<span class="co"># but for now we will use bioRad's example vertical profile already calculated:</span>
<span class="va">example_vp</span></code></pre></div>
<pre><code>##                Vertical profile (class vp)
## 
##        radar:  seang 
##       source:  WMO:02606,RAD:SE50,PLC:Angelholm,NOD:seang,ORG:82,CTY:643,CMT:Swedish radar 
## nominal time:  2015-10-18 18:00:00 
## generated by:  vol2bird 0.3.17</code></pre>
<p>Let’s plot the vertical profile, for the quantity eta (the linear reflectivity):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">example_vp</span>, quantity <span class="op">=</span> <span class="st">"eta"</span><span class="op">)</span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Note that eta is directly related to reflectivity factor (DBZH), i.e. a reflectivity factor of 5 dBZ amounts to the following eta at a radar wavelength of 5.3 cm:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/dbz_to_eta.html">dbz_to_eta</a></span><span class="op">(</span><span class="fl">5</span>, wavelength <span class="op">=</span> <span class="fl">5.3</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1060.747</code></pre>
</div>
<div id="spatial-estimates-of-vertically-integrated-density-vid" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-estimates-of-vertically-integrated-density-vid" class="anchor"></a>4 Spatial estimates of vertically integrated density (VID)</h2>
<p>Our goal is to estimate a spatial image of vertically integrated density (VID) based on all elevation scans of the radar, while accounting for the changing overlap between the radar beams as a function of range.</p>
<p>We start with:</p>
<ul>
<li>a polar volume, containing multiple scans</li>
<li>a vertical profile (of birds) calculated for that polar volume</li>
<li>a grid that we define relative to the earth’s surface, on which we will calculate the range corrected image. The pixel locations on the ground are easily translated into a corresponding azimuth and range of the various scans (see function <code><a href="../reference/beam_range.html">beam_range()</a></code>).</li>
</ul>
<p>For each scan within the polar volume we:</p>
<ul>
<li>calculate for each ground surface pixel the vertical radiation profile at that pixel for that particular scan, following above paragraph 2.</li>
<li>calculate the reflectivity we expect at that pixel (<span class="math inline">\(eta_{expected}\)</span>), given the vertical profile (of birds) and the part of the profile radiated by the beam. This <span class="math inline">\(eta_{expected}\)</span> is simply the average of (linear) eta in the profile (as plotted in paragraph 3 above), weighted by the vertical radiation profile (as plotted in paragraph 2).</li>
<li>we also calculated the observed eta at this pixel, which is simply given by <code><a href="../reference/dbz_to_eta.html">dbz_to_eta(DBZH)</a></code> (see paragraph 3), with DBZH the reflectivity factor measured at the pixel’s distance from the radar.</li>
</ul>
<p>For each pixel on the ground, we thus end up with a set of <span class="math inline">\(eta_{expected}\)</span> and a set of <span class="math inline">\(eta_{observed}\)</span>. From those we can calculate a correction factor at that pixel, as <span class="math inline">\(R=\sum{eta_{observed}}/\sum{eta_{expected}}\)</span>, with the sum running over scans.</p>
<p>To arrive at the final PPI image:</p>
<ul>
<li>we calculate the vertically integrated density (<code>vid</code>) and vertically integrated reflectivity (<code>vir</code>) for the profile, using the function <code><a href="../reference/integrate_profile.html">integrate_profile()</a></code>.</li>
<li>the spatial range-corrected PPI for <code>VID</code> is simply the adjustment factor image (<code>R</code>), multiplied by the <code>vid</code> calculated for the profile</li>
<li>Likewise, the spatial range-corrected PPI for <code>VIR</code> is simply the <code>R</code> image, multiplied by the <code>vir</code> calculated for the profile</li>
</ul>
</div>
<div id="example-estimating-a-vid-image" class="section level2">
<h2 class="hasAnchor">
<a href="#example-estimating-a-vid-image" class="anchor"></a>5 Example: estimating a VID image</h2>
<p>Let’s first make a PPI plot of the lowest uncorrected scan:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract the first scan from the polar volume:</span>
<span class="va">my_scan</span> <span class="op">&lt;-</span> <span class="va">example_pvol</span><span class="op">$</span><span class="va">scans</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="co"># project it as a PPI on the ground:</span>
<span class="va">my_ppi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project_as_ppi.html">project_as_ppi</a></span><span class="op">(</span><span class="va">my_scan</span>, range_max <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in proj4string(obj): CRS object has comment, which is lost in output</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot it</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">my_ppi</span><span class="op">)</span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Now let’s calculate the range-corrected PPI</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># let's use a 500 metre spatial grid (res), and restrict to 100x100 km area</span>
<span class="va">my_corrected_ppi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/integrate_to_ppi.html">integrate_to_ppi</a></span><span class="op">(</span><span class="va">example_pvol</span>, <span class="va">example_vp</span>, res <span class="op">=</span> <span class="fl">500</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100000</span>, <span class="fl">100000</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100000</span>, <span class="fl">100000</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in proj4string(output): CRS object has comment, which is lost in output</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_corrected_ppi</span></code></pre></div>
<pre><code>##                Plan position indicator (class ppi)
## 
##   parameters:  VIR VID R overlap eta_sum eta_sum_expected 
##         dims:  400 x 400 pixels</code></pre>
<p>The range corrected PPI has four parameters: VIR, VID, R, overlap. Let’s plot the adjustment factor R:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the adjustment factor R:</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">my_corrected_ppi</span>, param <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Let’s also plot the vertically integrated reflectivity:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">my_corrected_ppi</span>, param <span class="op">=</span> <span class="st">"VIR"</span><span class="op">)</span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Or plot the vertically integrated density on a map:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_basemap.html">download_basemap</a></span><span class="op">(</span><span class="va">my_corrected_ppi</span><span class="op">)</span></code></pre></div>
<pre><code>## Downloading zoom = 8 ...</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/136/78.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/137/78.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/138/78.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/136/79.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/137/79.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/138/79.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/136/80.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/137/80.png</code></pre>
<pre><code>## Source : http://tile.stamen.com/terrain/8/138/80.png</code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">my_corrected_ppi</span>, <span class="va">bm</span>, param <span class="op">=</span> <span class="st">"VIR"</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj =
## prefer_proj): Discarded ellps WGS 84 in Proj4 definition: +proj=merc +a=6378137
## +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null
## +wktext +no_defs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj =
## prefer_proj): Discarded datum WGS_1984 in Proj4 definition</code></pre>
<pre><code>## Warning in proj4string(mybbox): CRS object has comment, which is lost in output</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj =
## prefer_proj): Discarded ellps WGS 84 in Proj4 definition: +proj=merc +a=6378137
## +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null
## +wktext +no_defs +type=crs</code></pre>
<pre><code>## Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO", prefer_proj =
## prefer_proj): Discarded datum World Geodetic System 1984 in Proj4 definition</code></pre>
<p><img src="range_correction_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="overlap-between-radiation-profile-and-bird-profile" class="section level2">
<h2 class="hasAnchor">
<a href="#overlap-between-radiation-profile-and-bird-profile" class="anchor"></a>6 Overlap between radiation profile and bird profile</h2>
<p>At large distances from the radar we expect correction for range effects to become more difficult:</p>
<ol style="list-style-type: decimal">
<li>radar beams start to overshoot the aerial layers with biology, i.e. the overlap between the vertical profile and the emitted radiation profile decreases</li>
<li>at large distances weak biological echoes may get below the radar’s detection level</li>
</ol>
<p>We can calculate overlap between emitted radiation and the biological profile as follows:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate overlap between vertical profile of birds</span>
<span class="co"># and the vertical radiation profile emitted by the radar:</span>
<span class="va">bpo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/beam_profile_overlap.html">beam_profile_overlap</a></span><span class="op">(</span><span class="va">example_vp</span>, <span class="fu"><a href="../reference/get_elevation_angles.html">get_elevation_angles</a></span><span class="op">(</span><span class="va">example_pvol</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100000</span>, <span class="fl">1000</span><span class="op">)</span>, quantity <span class="op">=</span> <span class="st">"eta"</span><span class="op">)</span>
<span class="co"># plot the calculated overlap:</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">bpo</span><span class="op">)</span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>The function first normalizes the vertical profile altitudinal distribution. This can be either using profile quantity eta or dens, whichever is preferred (note that dens, the density, is sometimes thresholded to zero based on radial velocity standard deviation, see <code><a href="../reference/sd_vvp_threshold.html">sd_vvp_threshold()</a></code>, while eta is not)</p>
<p>It then calculates the overlap between the normalized vertical profile, and the normalized radiation profile as calculated with <code><a href="../reference/beam_profile.html">beam_profile()</a></code>, using a metric called the <a href="https://en.wikipedia.org/wiki/Bhattacharyya_distance">Bhattacharyya distance</a>. This metric is zero when there is no overlap, and 1 when the distributions are identical.</p>
<p>The range-corrected PPI also contains a field <code>overlap</code>, which contains the same metric but then calculated on the grid of the PPI:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">my_corrected_ppi</span>, param <span class="op">=</span> <span class="st">"overlap"</span><span class="op">)</span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>The overlap metric might be used in the future to show only certain section of the PPI, based on their overlap value.</p>
</div>
<div id="to-do" class="section level2">
<h2 class="hasAnchor">
<a href="#to-do" class="anchor"></a>7 To do</h2>
<ul>
<li>implementation of a <code>noise_floor</code> parameter, by which one can determine at which distance birds are expected to be below noise level, given their vertical profile. Affects function <code><a href="../reference/beam_profile_overlap.html">beam_profile_overlap()</a></code>.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://adriaandokter.com">Adriaan M. Dokter</a>, <a href="https://twitter.com/peterdesmet">Peter Desmet</a>, <a href="https://twitter.com/SVanHoey">Stijn Van Hoey</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '482e77c49caf113078e572738762cf40',
    indexName: 'biorad',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
