<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Correction for range effects • bioRad</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Correction for range effects">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bioRad</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.10.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/bioRad.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/rad_aero_22.html">Introductory exercises with bioRad</a></li>
    <li><a class="dropdown-item" href="../articles/range_correction.html">Correction for range effects</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/adokter/bioRad/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Correction for range effects</h1>
                        <h4 data-toc-skip class="author">Adriaan M.
Dokter</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/adokter/bioRad/blob/master/vignettes/range_correction.Rmd" class="external-link"><code>vignettes/range_correction.Rmd</code></a></small>
      <div class="d-none name"><code>range_correction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="preparations">1 Preparations<a class="anchor" aria-label="anchor" href="#preparations"></a>
</h2>
<p>Load bioRad</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"sp_evolution_status"</span> <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/adokter/bioRad/" class="external-link">bioRad</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Welcome to bioRad version 0.10.0.9000</span></span></code></pre>
<pre><code><span><span class="co">## using vol2birdR version 1.1.0 (MistNet not installed)</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="beam-propagation">2 Beam propagation<a class="anchor" aria-label="anchor" href="#beam-propagation"></a>
</h2>
<p>We start with the changing properties of the radar beam as it
propagates through the atmosphere. We define:</p>
<ul>
<li>
<strong>range</strong>: the length of the skywave path between
target and the radar antenna, also known as <em>slant range</em>
</li>
<li>
<strong>distance</strong>: the distance of the target from the radar
as measured along the earth’s surface, also known as <em>down
range</em>.</li>
</ul>
<p>The beam height is changing as a result of earth’s curvature, and
beam refraction:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a range grid from 0 to 200 km:</span></span>
<span><span class="va">my_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200000</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co"># plot the beam height for each range, for a 0.5 degree elevation beam:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_range</span>, <span class="fu"><a href="../reference/beam_height.html">beam_height</a></span><span class="op">(</span><span class="va">my_range</span>, elev <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"range [m]"</span>, ylab <span class="op">=</span> <span class="st">"beam height [m]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The beam width also broadens with range:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the beam width, for a beam opening angle of 1 degree (typical for most weather radars):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_range</span>, <span class="fu"><a href="../reference/beam_width.html">beam_width</a></span><span class="op">(</span><span class="va">my_range</span>, beam_angle <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"range [m]"</span>, ylab <span class="op">=</span> <span class="st">"beam width [m]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>We can now combine the relations for beam width and beam height, to
calculate the beam profile as a function of height, i.e. the altitudinal
normalized distribution of radiated energy by the beam. Let’s plot the
radiation profile for a 0.5 and 2 degree beam elevation at 50 km from
the radar (the height axis runs from ground level straight up):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the beam profile, for a 0.5 degree elevation beam at 50 km distance from the radar:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/beam_profile.html">beam_profile</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4000</span>, <span class="fl">50000</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">4000</span>, xlab <span class="op">=</span> <span class="st">"normalized radiated energy"</span>, ylab <span class="op">=</span> <span class="st">"height [m]"</span>, main <span class="op">=</span> <span class="st">"beam elevation: 0.5 deg, distance=50km"</span><span class="op">)</span></span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the beam profile, for a 2 degree elevation beam at 50 km distance from the radar:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/beam_profile.html">beam_profile</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4000</span>, <span class="fl">50000</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">4000</span>, xlab <span class="op">=</span> <span class="st">"normalized radiated energy"</span>, ylab <span class="op">=</span> <span class="st">"height [m]"</span>, main <span class="op">=</span> <span class="st">"beam elevation: 2 deg, distance=50km"</span><span class="op">)</span></span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<p>We can also calculate the normalized radiation profile for the two
beams combined:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the combined beam profile for a 0.5 and 2.0 degree elevation beam at 50 km distance from the radar:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/beam_profile.html">beam_profile</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4000</span>, <span class="fl">50000</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">4000</span>, xlab <span class="op">=</span> <span class="st">"normalized radiated energy"</span>, ylab <span class="op">=</span> <span class="st">"height [m]"</span>, main <span class="op">=</span> <span class="st">"beam elevations: 0.5,2 deg, distance=50km"</span><span class="op">)</span></span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="vertical-profiles-and-polar-volumes">3 Vertical profiles and polar volumes<a class="anchor" aria-label="anchor" href="#vertical-profiles-and-polar-volumes"></a>
</h2>
<p>Let us now assume we have calculated a vertical profile (of birds)
for a certain polar volume file. Let’s load an example</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># let's load an example polar volume:</span></span>
<span><span class="va">pvolfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"volume.h5"</span>, package <span class="op">=</span> <span class="st">"bioRad"</span><span class="op">)</span></span>
<span><span class="va">example_pvol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_pvolfile.html">read_pvolfile</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">pvolfile</span><span class="op">)</span></span>
<span><span class="co"># a vertical profile can also be calculated from the polar volume directly, using</span></span>
<span><span class="co"># calculate_vp(pvolfile)</span></span>
<span><span class="co"># but for now we will use bioRad's example vertical profile already calculated:</span></span>
<span><span class="va">example_vp</span></span></code></pre></div>
<pre><code><span><span class="co">##                Vertical profile (class vp)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##        radar:  seang </span></span>
<span><span class="co">##       source:  WMO:02606,RAD:SE50,PLC:Ängelholm,NOD:seang,ORG:82,CTY:643,CMT:Swedish radar </span></span>
<span><span class="co">## nominal time:  2015-10-18 18:00:00 </span></span>
<span><span class="co">## generated by:  vol2bird 0.3.17</span></span></code></pre>
<p>Let’s plot the vertical profile, for the quantity eta (the linear
reflectivity):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">example_vp</span>, quantity <span class="op">=</span> <span class="st">"eta"</span><span class="op">)</span></span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Note that eta is directly related to reflectivity factor (DBZH),
i.e. a reflectivity factor of 5 dBZ amounts to the following eta at a
radar wavelength of 5.3 cm:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dbz_to_eta.html">dbz_to_eta</a></span><span class="op">(</span><span class="fl">5</span>, wavelength <span class="op">=</span> <span class="fl">5.3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1140.588</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="spatial-estimates-of-vertically-integrated-density-vid">4 Spatial estimates of vertically integrated density (VID)<a class="anchor" aria-label="anchor" href="#spatial-estimates-of-vertically-integrated-density-vid"></a>
</h2>
<p>Our goal is to estimate a spatial image of vertically integrated
density (VID) based on all elevation scans of the radar, while
accounting for the changing overlap between the radar beams as a
function of range.</p>
<p>We start with:</p>
<ul>
<li>a polar volume, containing multiple scans</li>
<li>a vertical profile (of birds) calculated for that polar volume</li>
<li>a grid that we define relative to the earth’s surface, on which we
will calculate the range corrected image. The pixel locations on the
ground are easily translated into a corresponding azimuth and range of
the various scans (see function <code><a href="../reference/beam_range.html">beam_range()</a></code>).</li>
</ul>
<p>For each scan within the polar volume we:</p>
<ul>
<li>calculate for each ground surface pixel the vertical radiation
profile at that pixel for that particular scan, following above
paragraph 2.</li>
<li>calculate the reflectivity we expect at that pixel
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>t</mi><msub><mi>a</mi><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">eta_{expected}</annotation></semantics></math>),
given the vertical profile (of birds) and the part of the profile
radiated by the beam. This
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>t</mi><msub><mi>a</mi><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">eta_{expected}</annotation></semantics></math>
is simply the average of (linear) eta in the profile (as plotted in
paragraph 3 above), weighted by the vertical radiation profile (as
plotted in paragraph 2).</li>
<li>we also calculated the observed eta at this pixel, which is simply
given by <code>dbz_to_eta(DBZH)</code> (see paragraph 3), with DBZH the
reflectivity factor measured at the pixel’s distance from the
radar.</li>
</ul>
<p>For each pixel on the ground, we thus end up with a set of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>t</mi><msub><mi>a</mi><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">eta_{expected}</annotation></semantics></math>
and a set of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>t</mi><msub><mi>a</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">eta_{observed}</annotation></semantics></math>.
From those we can calculate a correction factor at that pixel, as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>=</mo><mo>∑</mo><mrow><mi>e</mi><mi>t</mi><msub><mi>a</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><mi>/</mi><mo>∑</mo><mrow><mi>e</mi><mi>t</mi><msub><mi>a</mi><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow></mrow><annotation encoding="application/x-tex">R=\sum{eta_{observed}}/\sum{eta_{expected}}</annotation></semantics></math>,
with the sum running over scans.</p>
<p>To arrive at the final PPI image:</p>
<ul>
<li>we calculate the vertically integrated density (<code>vid</code>)
and vertically integrated reflectivity (<code>vir</code>) for the
profile, using the function <code><a href="../reference/integrate_profile.html">integrate_profile()</a></code>.</li>
<li>the spatial range-corrected PPI for <code>VID</code> is simply the
adjustment factor image (<code>R</code>), multiplied by the
<code>vid</code> calculated for the profile</li>
<li>Likewise, the spatial range-corrected PPI for <code>VIR</code> is
simply the <code>R</code> image, multiplied by the <code>vir</code>
calculated for the profile</li>
</ul>
</div>
<div class="section level2">
<h2 id="example-estimating-a-vid-image">5 Example: estimating a VID image<a class="anchor" aria-label="anchor" href="#example-estimating-a-vid-image"></a>
</h2>
<p>Let’s first make a PPI plot of the lowest uncorrected scan:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract the first scan from the polar volume:</span></span>
<span><span class="va">my_scan</span> <span class="op">&lt;-</span> <span class="va">example_pvol</span><span class="op">$</span><span class="va">scans</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># project it as a PPI on the ground:</span></span>
<span><span class="va">my_ppi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project_as_ppi.html">project_as_ppi</a></span><span class="op">(</span><span class="va">my_scan</span>, range_max <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span></span>
<span><span class="co"># plot it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_ppi</span><span class="op">)</span></span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Now let’s calculate the range-corrected PPI</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># let's use a 500 metre spatial grid (res), and restrict to 100x100 km area</span></span>
<span><span class="va">my_corrected_ppi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/integrate_to_ppi.html">integrate_to_ppi</a></span><span class="op">(</span><span class="va">example_pvol</span>, <span class="va">example_vp</span>, res <span class="op">=</span> <span class="fl">500</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100000</span>, <span class="fl">100000</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100000</span>, <span class="fl">100000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">my_corrected_ppi</span></span></code></pre></div>
<pre><code><span><span class="co">##                Plan position indicator (class ppi)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   parameters:  VIR VID R overlap eta_sum eta_sum_expected </span></span>
<span><span class="co">##         dims:  400 x 400 pixels</span></span></code></pre>
<p>The range corrected PPI has four parameters: VIR, VID, R, overlap.
Let’s plot the adjustment factor R:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the adjustment factor R:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_corrected_ppi</span>, param <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span></span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Let’s also plot the vertically integrated reflectivity:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_corrected_ppi</span>, param <span class="op">=</span> <span class="st">"VIR"</span><span class="op">)</span></span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Or plot the vertically integrated density on a map:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bm</span> <span class="op">&lt;-</span> <span class="st">"osm"</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ggspatial"</span>,<span class="st">"prettymapr"</span>, <span class="st">"rosm"</span><span class="op">)</span>, <span class="va">requireNamespace</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">my_corrected_ppi</span>, map<span class="op">=</span><span class="va">bm</span>, param <span class="op">=</span> <span class="st">"VIR"</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## Zoom: 7</span></span></code></pre>
<pre><code><span><span class="co">## Fetching 4 missing tiles</span></span></code></pre>
<pre><code><span><span class="co">##   |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%</span></span></code></pre>
<pre><code><span><span class="co">## ...complete!</span></span></code></pre>
<p><img src="range_correction_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="overlap-between-radiation-profile-and-bird-profile">6 Overlap between radiation profile and bird profile<a class="anchor" aria-label="anchor" href="#overlap-between-radiation-profile-and-bird-profile"></a>
</h2>
<p>At large distances from the radar we expect correction for range
effects to become more difficult:</p>
<ol style="list-style-type: decimal">
<li>radar beams start to overshoot the aerial layers with biology,
i.e. the overlap between the vertical profile and the emitted radiation
profile decreases</li>
<li>at large distances weak biological echoes may get below the radar’s
detection level</li>
</ol>
<p>We can calculate overlap between emitted radiation and the biological
profile as follows:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate overlap between vertical profile of birds</span></span>
<span><span class="co"># and the vertical radiation profile emitted by the radar:</span></span>
<span><span class="va">bpo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/beam_profile_overlap.html">beam_profile_overlap</a></span><span class="op">(</span><span class="va">example_vp</span>, <span class="fu"><a href="../reference/get_elevation_angles.html">get_elevation_angles</a></span><span class="op">(</span><span class="va">example_pvol</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100000</span>, <span class="fl">1000</span><span class="op">)</span>, quantity <span class="op">=</span> <span class="st">"eta"</span><span class="op">)</span></span>
<span><span class="co"># plot the calculated overlap:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bpo</span><span class="op">)</span></span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>The function first normalizes the vertical profile altitudinal
distribution. This can be either using profile quantity eta or dens,
whichever is preferred (note that dens, the density, is sometimes
thresholded to zero based on radial velocity standard deviation, see
<code><a href="../reference/sd_vvp_threshold.html">sd_vvp_threshold()</a></code>, while eta is not)</p>
<p>It then calculates the overlap between the normalized vertical
profile, and the normalized radiation profile as calculated with
<code><a href="../reference/beam_profile.html">beam_profile()</a></code>, using a metric called the <a href="https://en.wikipedia.org/wiki/Bhattacharyya_distance" class="external-link">Bhattacharyya
distance</a>. This metric is zero when there is no overlap, and 1 when
the distributions are identical.</p>
<p>The range-corrected PPI also contains a field <code>overlap</code>,
which contains the same metric but then calculated on the grid of the
PPI:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_corrected_ppi</span>, param <span class="op">=</span> <span class="st">"overlap"</span><span class="op">)</span></span></code></pre></div>
<p><img src="range_correction_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>The overlap metric might be used in the future to show only certain
section of the PPI, based on their overlap value.</p>
</div>
<div class="section level2">
<h2 id="to-do">7 To do<a class="anchor" aria-label="anchor" href="#to-do"></a>
</h2>
<ul>
<li>implementation of a <code>noise_floor</code> parameter, by which one
can determine at which distance birds are expected to be below noise
level, given their vertical profile. Affects function
<code><a href="../reference/beam_profile_overlap.html">beam_profile_overlap()</a></code>.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adriaan M. Dokter, Peter Desmet, Bart Kranstauber, Cecilia Nilsson, Stijn Van Hoey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
