<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate a plan position indicator (ppi) of vertically integrated density adjusted for range effects — integrate_to_ppi • bioRad</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate a plan position indicator (ppi) of vertically integrated density adjusted for range effects — integrate_to_ppi"><meta name="description" content="Estimates a spatial image of vertically integrated density (vid) based on
all elevation scans of the radar, while accounting for the changing overlap
between the radar beams as a function of range. The resulting ppi is a
vertical integration over the layer of biological scatterers based on all
available elevation scans, corrected for range effects due to partial beam
overlap with the layer of biological echoes (overshooting) at larger
distances from the radar. The methodology is described in detail in
Kranstauber et al. (2020)."><meta property="og:description" content="Estimates a spatial image of vertically integrated density (vid) based on
all elevation scans of the radar, while accounting for the changing overlap
between the radar beams as a function of range. The resulting ppi is a
vertical integration over the layer of biological scatterers based on all
available elevation scans, corrected for range effects due to partial beam
overlap with the layer of biological echoes (overshooting) at larger
distances from the radar. The methodology is described in detail in
Kranstauber et al. (2020)."><meta property="og:image" content="http://adriaandokter.com/bioRad/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bioRad</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.10.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/bioRad.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/rad_aero_22.html">Introductory exercises with bioRad</a></li>
    <li><a class="dropdown-item" href="../articles/range_correction.html">Correction for range effects</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/adokter/bioRad/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate a plan position indicator (<code>ppi</code>) of vertically integrated density adjusted for range effects</h1>
      <small class="dont-index">Source: <a href="https://github.com/adokter/bioRad/blob/0.10.0/R/integrate_to_ppi.R" class="external-link"><code>R/integrate_to_ppi.R</code></a></small>
      <div class="d-none name"><code>integrate_to_ppi.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimates a spatial image of vertically integrated density (<code>vid</code>) based on
all elevation scans of the radar, while accounting for the changing overlap
between the radar beams as a function of range. The resulting <code>ppi</code> is a
vertical integration over the layer of biological scatterers based on all
available elevation scans, corrected for range effects due to partial beam
overlap with the layer of biological echoes (overshooting) at larger
distances from the radar. The methodology is described in detail in
Kranstauber et al. (2020).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">integrate_to_ppi</span><span class="op">(</span></span>
<span>  <span class="va">pvol</span>,</span>
<span>  <span class="va">vp</span>,</span>
<span>  nx <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  ny <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  <span class="va">xlim</span>,</span>
<span>  <span class="va">ylim</span>,</span>
<span>  zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4000</span><span class="op">)</span>,</span>
<span>  <span class="va">res</span>,</span>
<span>  quantity <span class="op">=</span> <span class="st">"eta"</span>,</span>
<span>  param <span class="op">=</span> <span class="st">"DBZH"</span>,</span>
<span>  raster <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">lat</span>,</span>
<span>  <span class="va">lon</span>,</span>
<span>  <span class="va">antenna</span>,</span>
<span>  beam_angle <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">crs</span>,</span>
<span>  param_ppi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VIR"</span>, <span class="st">"VID"</span>, <span class="st">"R"</span>, <span class="st">"overlap"</span>, <span class="st">"eta_sum"</span>, <span class="st">"eta_sum_expected"</span><span class="op">)</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">4</span><span class="op">/</span><span class="fl">3</span>,</span>
<span>  re <span class="op">=</span> <span class="fl">6378</span>,</span>
<span>  rp <span class="op">=</span> <span class="fl">6357</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-pvol">pvol<a class="anchor" aria-label="anchor" href="#arg-pvol"></a></dt>
<dd><p>A <code>pvol</code> object.</p></dd>


<dt id="arg-vp">vp<a class="anchor" aria-label="anchor" href="#arg-vp"></a></dt>
<dd><p>A <code>vp</code> object</p></dd>


<dt id="arg-nx">nx<a class="anchor" aria-label="anchor" href="#arg-nx"></a></dt>
<dd><p>number of raster pixels in the x (longitude) dimension</p></dd>


<dt id="arg-ny">ny<a class="anchor" aria-label="anchor" href="#arg-ny"></a></dt>
<dd><p>number of raster pixels in the y (latitude) dimension</p></dd>


<dt id="arg-xlim">xlim<a class="anchor" aria-label="anchor" href="#arg-xlim"></a></dt>
<dd><p>x (longitude) range</p></dd>


<dt id="arg-ylim">ylim<a class="anchor" aria-label="anchor" href="#arg-ylim"></a></dt>
<dd><p>y (latitude) range</p></dd>


<dt id="arg-zlim">zlim<a class="anchor" aria-label="anchor" href="#arg-zlim"></a></dt>
<dd><p>Numeric vector of length two. Altitude range, in m</p></dd>


<dt id="arg-res">res<a class="anchor" aria-label="anchor" href="#arg-res"></a></dt>
<dd><p>numeric vector of length 1 or 2 to set the resolution of the raster (see res).
If this argument is used, arguments <code>nx</code> and <code>ny</code> are ignored. Unit is identical to <code>xlim</code> and <code>ylim</code>.</p></dd>


<dt id="arg-quantity">quantity<a class="anchor" aria-label="anchor" href="#arg-quantity"></a></dt>
<dd><p>Character. Profile quantity on which to base range
corrections, either <code>eta</code> or <code>dens</code>.</p></dd>


<dt id="arg-param">param<a class="anchor" aria-label="anchor" href="#arg-param"></a></dt>
<dd><p>reflectivity Character. Scan parameter on which to base range
corrections. Typically the same parameter from which animal densities are
estimated in <code>vp</code>. Either <code>DBZH</code>, <code>DBZV</code>, <code>DBZ</code>, <code>TH</code>, or <code>TV</code>.</p></dd>


<dt id="arg-raster">raster<a class="anchor" aria-label="anchor" href="#arg-raster"></a></dt>
<dd><p>(optional) RasterLayer with a CRS. When specified this raster topology is used for the output, and nx, ny, res
arguments are ignored.</p></dd>


<dt id="arg-lat">lat<a class="anchor" aria-label="anchor" href="#arg-lat"></a></dt>
<dd><p>Latitude of the radar, in degrees. If missing taken from <code>pvol</code>.</p></dd>


<dt id="arg-lon">lon<a class="anchor" aria-label="anchor" href="#arg-lon"></a></dt>
<dd><p>Latitude of the radar, in degrees. If missing taken from <code>pvol</code>.</p></dd>


<dt id="arg-antenna">antenna<a class="anchor" aria-label="anchor" href="#arg-antenna"></a></dt>
<dd><p>Numeric. Radar antenna height, in m. Default to antenna height
in <code>vp</code>.</p></dd>


<dt id="arg-beam-angle">beam_angle<a class="anchor" aria-label="anchor" href="#arg-beam-angle"></a></dt>
<dd><p>Numeric. Beam opening angle in degrees, typically the
angle between the half-power (-3 dB) points of the main lobe.</p></dd>


<dt id="arg-crs">crs<a class="anchor" aria-label="anchor" href="#arg-crs"></a></dt>
<dd><p>character or object of class CRS. PROJ.4 type description of a Coordinate Reference System (map projection).
When 'NA' (default), an azimuthal equidistant projection with origin at the radar location is used.
To use a WSG84 (lat,lon) projection, use crs="+proj=longlat +datum=WGS84"</p></dd>


<dt id="arg-param-ppi">param_ppi<a class="anchor" aria-label="anchor" href="#arg-param-ppi"></a></dt>
<dd><p>Character (vector). One or multiple of <code>VIR</code>, <code>VID</code>, <code>R</code>,
<code>overlap</code>, <code>eta_sum</code> or <code>eta_sum_expected</code>.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>Numeric. Standard refraction coefficient.</p></dd>


<dt id="arg-re">re<a class="anchor" aria-label="anchor" href="#arg-re"></a></dt>
<dd><p>Numeric. Earth equatorial radius, in km.</p></dd>


<dt id="arg-rp">rp<a class="anchor" aria-label="anchor" href="#arg-rp"></a></dt>
<dd><p>Numeric. Earth polar radius, in km.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>ppi</code> object with the following parameters:</p><ul><li><p><code>VIR</code>: the vertically integrated reflectivity in cm^2/km^2</p></li>
<li><p><code>VID</code>: the vertically integrated density in 1/km^2</p></li>
<li><p><code>R</code>: the spatial adjustment factor (unitless). See Kranstauber 2020 for details.
Equal to <code>eta_sum</code>/<code>eta_sum_expected</code>.</p></li>
<li><p><code>overlap</code>: the distribution overlap between the vertical profile <code>vp</code> and
the vertical radiation profile for the set of radar sweeps in <code>pvol</code>,
as calculated with <a href="beam_profile_overlap.html">beam_profile_overlap</a>.</p></li>
<li><p><code>eta_sum</code>: the sum of observed linear reflectivities over elevation angles.
See Kranstauber 2020 for details.</p></li>
<li><p><code>eta_sum_expected</code>: the sum of expected linear reflectivities over elevation angles
based on the input vertical profile <code>vp</code>. See Kranstauber 2020 for details.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function requires:</p><ul><li><p>A polar volume, containing one or multiple scans (<code>pvol</code>).</p></li>
<li><p>A vertical profile (of birds) calculated for that same polar volume (<code>vp</code>).</p></li>
<li><p>A grid defined on the earth's surface, on which we will calculate the range
corrected image (defined by <code>raster</code>, or a combination of <code>nx</code>, <code>ny</code>,<code>res</code>
arguments).</p></li>
</ul><p>The pixel locations on the ground are easily translated into a corresponding
azimuth and range of the various scans (see <code><a href="beam_range.html">beam_range()</a></code>).</p>
<p>For each scan within the polar volume, the function calculates:</p><ul><li><p>the vertical radiation profile for each ground surface pixel for that
particular scan, using <a href="beam_profile.html">beam_profile</a>.</p></li>
<li><p>the reflectivity expected for each ground surface pixel
(\(\eta_{expected}\)), given the vertical profile (of biological
scatterers) and the part of the profile radiated by the beam.
This \(\eta_{expected}\) is simply the average of (linear) <code>eta</code> in the
profile, weighted by the vertical radiation profile.</p></li>
<li><p>the observed eta at each pixel \(\eta_{observed}\), which is converted
form <code>DBZH</code> using function <a href="dbz_to_eta.html">dbz_to_eta</a>, with <code>DBZH</code> the reflectivity
factor measured at the pixel's distance from the radar.</p></li>
</ul><p>If one of <code>lat</code> or <code>lon</code> is missing, the extent of the <code>ppi</code> is taken equal
to the extent of the data in the first scan of the polar volume.</p>
<p>To arrive at the final PPI image, the function calculates</p><ul><li><p>the vertically integrated density (<code>vid</code>) and vertically integrated
reflectivity (<code>vir</code>) for the profile, using the function
<a href="integrate_profile.html">integrate_profile</a>.</p></li>
<li><p>the spatial range-corrected PPI for <code>VID</code>, defined as the adjustment
factor image (<code>R</code>), multiplied by the <code>vid</code> calculated for the profile</p></li>
<li><p>the spatial range-corrected PPI for <code>VIR</code>, defined as the adjustment
factor <code>R</code>, multiplied by the <code>vir</code> calculated for the profile.</p></li>
</ul><p>Scans at 90 degree beam elevation (e.g. birdbath scans) are ignored.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Kranstauber B, Bouten W, Leijnse H, Wijers B, Verlinden L, Shamoun-Baranes
J, Dokter AM (2020) High-Resolution Spatial Distribution of Bird Movements
Estimated from a Weather Radar Network. Remote Sensing 12 (4), 635.
<a href="https://doi.org/10.3390/rs12040635" class="external-link">doi:10.3390/rs12040635</a></p></li>
<li><p>Buler JJ &amp; Diehl RH (2009) Quantifying bird density during migratory
stopover using weather surveillance radar. IEEE Transactions on Geoscience
and Remote Sensing 47: 2741-2751.
<a href="https://doi.org/10.1109/TGRS.2009.2014463" class="external-link">doi:10.1109/TGRS.2009.2014463</a></p></li>
</ul><ul><li><p>Kranstauber B, Bouten W, Leijnse H, Wijers B, Verlinden L, Shamoun-Baranes
J, Dokter AM (2020) High-Resolution Spatial Distribution of Bird
Movements Estimated from a Weather Radar Network. Remote Sensing 12 (4),
635. <a href="https://doi.org/10.3390/rs12040635" class="external-link">doi:10.3390/rs12040635</a></p></li>
<li><p>Buler JJ &amp; Diehl RH (2009) Quantifying bird density during migratory
stopover using weather surveillance radar. IEEE Transactions on Geoscience
and Remote Sensing 47: 2741-2751.
<a href="https://doi.org/10.1109/TGRS.2009.2014463" class="external-link">doi:10.1109/TGRS.2009.2014463</a></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><code><a href="summary.ppi.html">summary.ppi()</a></code></p></li>
<li><p><code><a href="beam_profile.html">beam_profile()</a></code></p></li>
<li><p><code><a href="beam_range.html">beam_range()</a></code></p></li>
<li><p><code><a href="integrate_profile.html">integrate_profile()</a></code></p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Locate and read the polar volume example file</span></span></span>
<span class="r-in"><span><span class="va">pvolfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"volume.h5"</span>, package <span class="op">=</span> <span class="st">"bioRad"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load polar volume</span></span></span>
<span class="r-in"><span><span class="va">pvol</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_pvolfile.html">read_pvolfile</a></span><span class="op">(</span><span class="va">pvolfile</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Read the corresponding vertical profile example</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">example_vp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the range-corrected ppi on a 50x50 pixel raster</span></span></span>
<span class="r-in"><span><span class="va">ppi</span> <span class="op">&lt;-</span> <span class="fu">integrate_to_ppi</span><span class="op">(</span><span class="va">pvol</span>, <span class="va">example_vp</span>, nx <span class="op">=</span> <span class="fl">50</span>, ny <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the vertically integrated reflectivity (VIR) using a</span></span></span>
<span class="r-in"><span><span class="co"># 0-2000 cm^2/km^2 color scale</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ppi</span>, zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="integrate_to_ppi-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the range-corrected ppi on finer 2000m x 2000m pixel raster</span></span></span>
<span class="r-in"><span><span class="va">ppi</span> <span class="op">&lt;-</span> <span class="fu">integrate_to_ppi</span><span class="op">(</span><span class="va">pvol</span>, <span class="va">example_vp</span>, res <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the vertically integrated density (VID) using a</span></span></span>
<span class="r-in"><span><span class="co"># 0-200 birds/km^2 color scale</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ppi</span>, param <span class="op">=</span> <span class="st">"VID"</span>, zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="integrate_to_ppi-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Download a basemap and map the ppi</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ggspatial"</span>,<span class="st">"prettymapr"</span>, <span class="st">"rosm"</span><span class="op">)</span>, <span class="va">requireNamespace</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="map.html">map</a></span><span class="op">(</span><span class="va">ppi</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Zoom: 5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Fetching 4 missing tiles</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ...complete!</span>
<span class="r-plt img"><img src="integrate_to_ppi-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The ppi can also be projected on a user-defined raster, as follows:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># First define the raster</span></span></span>
<span class="r-in"><span><span class="va">template_raster</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html" class="external-link">extent</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">13</span>, <span class="fl">56</span>, <span class="fl">57</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  crs <span class="op">=</span> <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://edzer.github.io/sp/reference/CRS-class.html" class="external-link">CRS</a></span><span class="op">(</span><span class="st">"+proj=longlat"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Project the ppi on the defined raster</span></span></span>
<span class="r-in"><span><span class="va">ppi</span> <span class="op">&lt;-</span> <span class="fu">integrate_to_ppi</span><span class="op">(</span><span class="va">pvol</span>, <span class="va">example_vp</span>, raster <span class="op">=</span> <span class="va">template_raster</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract the raster data from the ppi object</span></span></span>
<span class="r-in"><span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html" class="external-link">brick</a></span><span class="op">(</span><span class="va">ppi</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> class      : RasterBrick </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> dimensions : 10, 10, 100, 6  (nrow, ncol, ncell, nlayers)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> resolution : 0.1, 0.1  (x, y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> extent     : 12, 13, 56, 57  (xmin, xmax, ymin, ymax)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> crs        : +proj=longlat +datum=WGS84 +no_defs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> source     : memory</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> names      :          VIR,          VID,            R,      overlap,      eta_sum, eta_sum_expected </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> min values :    0.0000000,    0.0000000,    0.0000000,    0.3189387,    0.0000000,      406.9671616 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> max values : 6.507961e+04, 5.892510e+03, 6.614504e+01, 9.217694e-01, 6.955712e+04,     3.196694e+03 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the range-corrected ppi on an even finer 500m x 500m pixel raster,</span></span></span>
<span class="r-in"><span><span class="co"># cropping the area up to 50000 meter from the radar</span></span></span>
<span class="r-in"><span><span class="va">ppi</span> <span class="op">&lt;-</span> <span class="fu">integrate_to_ppi</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">pvol</span>, <span class="va">example_vp</span>, res <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50000</span>, <span class="fl">50000</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50000</span>, <span class="fl">50000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ppi</span>, param <span class="op">=</span> <span class="st">"VID"</span>, zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="integrate_to_ppi-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adriaan M. Dokter, Peter Desmet, Bart Kranstauber, Cecilia Nilsson, Stijn Van Hoey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

