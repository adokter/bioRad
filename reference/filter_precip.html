<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Posthoc precipitation filter — filter_precip • bioRad</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Posthoc precipitation filter — filter_precip"><meta name="description" content="The posthoc precipitation filter assesses how much of the altitude column has a high
total reflectivity factor (biology + meteorology) consistent with precipitation,
and removes biological signals when there is evidence for the presence of precipitation.
Applied to vertical profiles ('vp') or time series of vertical profiles ('vpts')."><meta property="og:description" content="The posthoc precipitation filter assesses how much of the altitude column has a high
total reflectivity factor (biology + meteorology) consistent with precipitation,
and removes biological signals when there is evidence for the presence of precipitation.
Applied to vertical profiles ('vp') or time series of vertical profiles ('vpts')."><meta property="og:image" content="http://adriaandokter.com/bioRad/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bioRad</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.11.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/bioRad.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/rad_aero_22.html">Introductory exercises with bioRad</a></li>
    <li><a class="dropdown-item" href="../articles/range_correction.html">Correction for range effects</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/adokter/bioRad/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Posthoc precipitation filter</h1>
      <small class="dont-index">Source: <a href="https://github.com/adokter/bioRad/blob/master/R/filter_precip.R" class="external-link"><code>R/filter_precip.R</code></a></small>
      <div class="d-none name"><code>filter_precip.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The posthoc precipitation filter assesses how much of the altitude column has a high
total reflectivity factor (biology + meteorology) consistent with precipitation,
and removes biological signals when there is evidence for the presence of precipitation.
Applied to vertical profiles ('vp') or time series of vertical profiles ('vpts').</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">filter_precip</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  dbz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">attributes</span><span class="op">$</span><span class="va">how</span><span class="op">$</span><span class="va">wavelength</span> <span class="op">&lt;</span> <span class="fl">7</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">attributes</span><span class="op">$</span><span class="va">how</span><span class="op">$</span><span class="va">wavelength</span><span class="op">)</span>,</span>
<span>    <span class="fl">7</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  range <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>  alt_max <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>  drop <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <code>vp</code> or <code>vpts</code> object.</p></dd>


<dt id="arg-dbz">dbz<a class="anchor" aria-label="anchor" href="#arg-dbz"></a></dt>
<dd><p>The minimum reflectivity factor for precipitation in units dBZ.
Defaults to 7 dBZ for C-band radars and 20 dBZ for S-band radars.</p></dd>


<dt id="arg-range">range<a class="anchor" aria-label="anchor" href="#arg-range"></a></dt>
<dd><p>The minimum altitude range with total reflectivity factor.
<code>DBZH</code> &gt; <code>dbz</code> at which the filter is triggered in m.</p></dd>


<dt id="arg-alt-max">alt_max<a class="anchor" aria-label="anchor" href="#arg-alt-max"></a></dt>
<dd><p>Maximum altitude above ground level to consider in m.</p></dd>


<dt id="arg-drop">drop<a class="anchor" aria-label="anchor" href="#arg-drop"></a></dt>
<dd><p>When <code>TRUE</code> the profile is removed from the</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>vpts</code> object or a <code>vp</code> object, depending on input <code>x</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>During precipitation events usually a high proportion of the altitude
column will show a high total reflectivity <code>DBZH</code> (which includes biology +
meteorology), because precipitation usually falls from several kilometers high
to the ground surface. Precipitation events are often obvious in profile plots
of quantity <code>DBZH</code> as reflectivity signals extending from ground level to high
altitudes far above the typical altitudes where biology is expected. This filter
identifies and removes these cases.</p>
<p>The posthoc precipitation filter examines the total reflectivity factor <code>DBZH</code>
and calculates the altitude range at which <code>DBZH</code> is larger than parameter
<code>dbz</code>. Whenever this altitude range is larger than parameter <code>range</code> (and <code>drop</code>
is <code>FALSE</code>), the biology is removed by setting profile quantities <code>dens</code> and <code>eta</code>
to zero and profile quantity <code>dbz</code> to <code>-Inf</code>. When parameter <code>drop</code>
is <code>TRUE</code>, the profile is removed from the time series altogether.</p>
<p>This posthoc precipitation filter is likely to remove biological scatterers
that co-occur with precipitation, for example biological movements during isolated
convective thunderstorms. It is more aggressive than precipitation filters
applied during vertical profile generation with <code><a href="calculate_vp.html">calculate_vp()</a></code> that attempt to
remove precipitation and retain biology. The posthoc precipitation filter is especially
useful for analyses where you want to minimize the risk of precipitation contamination,
at the cost of filtering out some biology during precipitation events.</p>
<p>Lowering the default minimum reflectivity (<code>dbz</code>) for precipitation
below 7 dBZ is not recommended, as most precipitation has a reflectivity above 7 dBZ.</p>
<p>Parameter <code>range</code> should be chosen carefully, and should be higher than the
typical altitude where biological scatterers still reach a reflectivity factor equal to <code>dbz</code>.</p>
<p>Note that at S-band wavelengths bird migration occurs much more frequently in the reflectivity
regime for precipitation than at C-band. Therefore, at C-band lower settings for parameter <code>dbz</code>
are appropriate than at S-band.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><a href="eta_to_dbz.html">eta_to_dbz</a></p></li>
<li><p><a href="dbz_to_eta.html">dbz_to_eta</a></p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># rain periods are visible in quantity DBZH as dark vertical lines</span></span></span>
<span class="r-in"><span><span class="co"># extending above 3 km height:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="regularize_vpts.html">regularize_vpts</a></span><span class="op">(</span><span class="va">example_vpts</span><span class="op">)</span>, quantity<span class="op">=</span><span class="st">'DBZH'</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> projecting on 300 seconds interval grid...</span>
<span class="r-plt img"><img src="filter_precip-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Apply posthoc filter to remove profiles during precipitation events:</span></span></span>
<span class="r-in"><span><span class="co"># (regularization is applied to visualize removed profiles)</span></span></span>
<span class="r-in"><span><span class="va">my_vpts</span> <span class="op">&lt;-</span> <span class="fu"><a href="regularize_vpts.html">regularize_vpts</a></span><span class="op">(</span><span class="fu">filter_precip</span><span class="op">(</span><span class="va">example_vpts</span>, drop<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> projecting on 360 seconds interval grid...</span>
<span class="r-in"><span><span class="co"># verify that rain events have been removed:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_vpts</span>, quantity<span class="op">=</span><span class="st">'DBZH'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="filter_precip-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># the posthoc filter removes some biology during precipitation:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_vpts</span>, quantity<span class="op">=</span><span class="st">'dens'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="filter_precip-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># original retains more biology (but at the cost of a higher</span></span></span>
<span class="r-in"><span><span class="co"># likelihood of occasional precipitation contamination):</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="regularize_vpts.html">regularize_vpts</a></span><span class="op">(</span><span class="va">example_vpts</span><span class="op">)</span>, quantity<span class="op">=</span><span class="st">'dens'</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> projecting on 300 seconds interval grid...</span>
<span class="r-plt img"><img src="filter_precip-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># filter can also be applied to single vp objects:</span></span></span>
<span class="r-in"><span><span class="fu">filter_precip</span><span class="op">(</span><span class="va">example_vp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Vertical profile (class vp)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        radar:  seang </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       source:  WMO:02606,RAD:SE50,PLC:Ängelholm,NOD:seang,ORG:82,CTY:643,CMT:Swedish radar </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nominal time:  2015-10-18 18:00:00 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> generated by:  vol2bird 0.3.17 </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adriaan M. Dokter, Peter Desmet, Bart Kranstauber, Cecilia Nilsson, Alexander Tedeschi, Stijn Van Hoey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

