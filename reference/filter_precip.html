<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Posthoc precipitation filter — filter_precip • bioRad</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous"><link href="../docsearch.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Posthoc precipitation filter — filter_precip"><meta property="og:description" content="The posthoc precipitation filter assesses how much of the altitude column has a high
total reflectivity factor (biology + meteorology) consistent with precipitation,
and removes biological signals when there is evidence for the presence of precipitation.
Applied to vertical profiles ('vp') or time series of vertical profiles ('vpts')."><meta property="og:image" content="https://adriaandokter.com/bioRad/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bioRad</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/bioRad.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/rad_aero_22.html">Introductory exercises with bioRad</a>
    </li>
    <li>
      <a href="../articles/range_correction.html">Correction for range effects</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/adokter/bioRad/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul><form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off"></div>
      </form>

    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Posthoc precipitation filter</h1>
    <small class="dont-index">Source: <a href="https://github.com/adokter/bioRad/blob/master/R/filter_precip.R" class="external-link"><code>R/filter_precip.R</code></a></small>
    <div class="hidden name"><code>filter_precip.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The posthoc precipitation filter assesses how much of the altitude column has a high
total reflectivity factor (biology + meteorology) consistent with precipitation,
and removes biological signals when there is evidence for the presence of precipitation.
Applied to vertical profiles ('vp') or time series of vertical profiles ('vpts').</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">filter_precip</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  dbz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">attributes</span><span class="op">$</span><span class="va">how</span><span class="op">$</span><span class="va">wavelength</span> <span class="op">&lt;</span> <span class="fl">7</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">attributes</span><span class="op">$</span><span class="va">how</span><span class="op">$</span><span class="va">wavelength</span><span class="op">)</span>,</span>
<span>    <span class="fl">7</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  range <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>  alt_max <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>  drop <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <code>vp</code> or <code>vpts</code> object.</p></dd>


<dt id="arg-dbz">dbz<a class="anchor" aria-label="anchor" href="#arg-dbz"></a></dt>
<dd><p>The minimum reflectivity factor for precipitation in units dBZ.
Defaults to 7 dBZ for C-band radars and 20 dBZ for S-band radars.</p></dd>


<dt id="arg-range">range<a class="anchor" aria-label="anchor" href="#arg-range"></a></dt>
<dd><p>The minimum altitude range with total reflectivity factor.
<code>DBZH</code> &gt; <code>dbz</code> at which the filter is triggered in m.</p></dd>


<dt id="arg-alt-max">alt_max<a class="anchor" aria-label="anchor" href="#arg-alt-max"></a></dt>
<dd><p>Maximum altitude above ground level to consider in m.</p></dd>


<dt id="arg-drop">drop<a class="anchor" aria-label="anchor" href="#arg-drop"></a></dt>
<dd><p>When <code>TRUE</code> the profile is removed from the</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A <code>vpts</code> object or a <code>vp</code> object, depending on input <code>x</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>During precipitation events usually a high proportion of the altitude
column will show a high total reflectivity <code>DBZH</code> (which includes biology +
meteorology), because precipitation usually falls from several kilometers high
to the ground surface. Precipitation events are often obvious in profile plots
of quantity <code>DBZH</code> as reflectivity signals extending from ground level to high
altitudes far above the typical altitudes where biology is expected. This filter
identifies and removes these cases.</p>
<p>The posthoc precipitation filter examines the total reflectivity factor <code>DBZH</code>
and calculates the altitude range at which <code>DBZH</code> is larger than parameter
<code>dbz</code>. Whenever this altitude range is larger than parameter <code>range</code> (and <code>drop</code>
is <code>FALSE</code>), the biology is removed by setting profile quantities <code>dens</code> and <code>eta</code>
to zero and profile quantity <code>dbz</code> to <code>-Inf</code>. When parameter <code>drop</code>
is <code>TRUE</code>, the profile is removed from the time series altogether.</p>
<p>This posthoc precipitation filter is likely to remove biological scatterers
that co-occur with precipitation, for example biological movements during isolated
convective thunderstorms. It is more aggressive than precipitation filters
applied during vertical profile generation with <code><a href="calculate_vp.html">calculate_vp()</a></code> that attempt to
remove precipitation and retain biology. The posthoc precipitation filter is especially
useful for analyses where you want to minimize the risk of precipitation contamination,
at the cost of filtering out some biology during precipitation events.</p>
<p>Lowering the default minimum reflectivity (<code>dbz</code>) for precipitation
below 7 dBZ is not recommended, as most precipitation has a reflectivity above 7 dBZ.</p>
<p>Parameter <code>range</code> should be chosen carefully, and should be higher than the
typical altitude where biological scatterers still reach a reflectivity factor equal to <code>dbz</code>.</p>
<p>Note that at S-band wavelengths bird migration occurs much more frequently in the reflectivity
regime for precipitation than at C-band. Therefore, at C-band lower settings for parameter <code>dbz</code>
are appropriate than at S-band.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index">
<ul><li><p><a href="eta_to_dbz.html">eta_to_dbz</a></p></li>
<li><p><a href="dbz_to_eta.html">dbz_to_eta</a></p></li>
</ul></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># rain periods are visible in quantity DBZH as dark vertical lines</span></span></span>
<span class="r-in"><span><span class="co"># extending above 3 km height:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="regularize_vpts.html">regularize_vpts</a></span><span class="op">(</span><span class="va">example_vpts</span><span class="op">)</span>, quantity<span class="op">=</span><span class="st">'DBZH'</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> projecting on 300 seconds interval grid...</span>
<span class="r-plt img"><img src="filter_precip-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Apply posthoc filter to remove profiles during precipitation events:</span></span></span>
<span class="r-in"><span><span class="co"># (regularization is applied to visualize removed profiles)</span></span></span>
<span class="r-in"><span><span class="va">my_vpts</span> <span class="op">&lt;-</span> <span class="fu"><a href="regularize_vpts.html">regularize_vpts</a></span><span class="op">(</span><span class="fu">filter_precip</span><span class="op">(</span><span class="va">example_vpts</span>, drop<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> projecting on 360 seconds interval grid...</span>
<span class="r-in"><span><span class="co"># verify that rain events have been removed:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_vpts</span>, quantity<span class="op">=</span><span class="st">'DBZH'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="filter_precip-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># the posthoc filter removes some biology during precipitation:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_vpts</span>, quantity<span class="op">=</span><span class="st">'dens'</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="filter_precip-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># original retains more biology (but at the cost of a higher</span></span></span>
<span class="r-in"><span><span class="co"># likelihood of occasional precipitation contamination):</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="regularize_vpts.html">regularize_vpts</a></span><span class="op">(</span><span class="va">example_vpts</span><span class="op">)</span>, quantity<span class="op">=</span><span class="st">'dens'</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> projecting on 300 seconds interval grid...</span>
<span class="r-plt img"><img src="filter_precip-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># filter can also be applied to single vp objects:</span></span></span>
<span class="r-in"><span><span class="fu">filter_precip</span><span class="op">(</span><span class="va">example_vp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Vertical profile (class vp)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        radar:  seang </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       source:  WMO:02606,RAD:SE50,PLC:Ängelholm,NOD:seang,ORG:82,CTY:643,CMT:Swedish radar </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nominal time:  2015-10-18 18:00:00 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> generated by:  vol2bird 0.3.17 </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="http://adriaandokter.com" class="external-link">Adriaan M. Dokter</a>, <a href="https://twitter.com/peterdesmet" class="external-link">Peter Desmet</a>, Bart Kranstauber, Cecilia Nilsson, <a href="https://twitter.com/SVanHoey" class="external-link">Stijn Van Hoey</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({


    apiKey: '482e77c49caf113078e572738762cf40',
    indexName: 'biorad',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script></body></html>

